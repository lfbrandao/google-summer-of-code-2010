var vote=function(){var j={informModerator:-1,undoMod:0,acceptedByOwner:1,upMod:2,downMod:3,offensive:4,favorite:5,close:6,reopen:7,bountyClose:9,deletion:10,undeletion:11,spam:12};var c="View upvote and downvote totals";var l=function(){var z='<a href="/users/login?returnurl='+escape(document.location)+'">login or register</a>';h().click(function(){t($(this),"Please "+z+" to vote for this post.")});w().unbind("click").click(function(){t($(this),"Please "+z+" to flag this post.")})};var r=false;var x=function(z){if(r){var A=z.is('[id^="flag-post-"]')?"flag":z.is(".star-off")?"favorite":"vote for";t(z,'Please <a href="/users/login?returnurl='+escape(document.location)+'">login or register</a> to '+A+" this post.")}return r};var y=function(z){if(!z){z="div.vote"}$(z).find(".vote-up-off").unbind("click").click(function(){vote.up($(this))});$(z).find(".vote-down-off").unbind("click").click(function(){vote.down($(this))})};var h=function(z){var A=z?z.closest("div.vote"):$("div.vote");return A.find(".vote-up-off, .vote-down-off").unbind("click")};var d=function(z){$.ajax({type:"GET",url:"/posts/"+z+"/votes",dataType:"json",success:u})};var u=function(z){$.each(z,function(){var A=$("div.vote:has(input[value="+this.PostId+"])");switch(this.VoteTypeId){case j.upMod:A.find(".vote-up-off").addClass("vote-up-on");break;case j.downMod:A.find(".vote-down-off").addClass("vote-down-on");break;case j.favorite:A.find(".star-off").addClass("star-on");A.find("div.favoritecount b").addClass("favoritecount-selected");break;default:alert("site.vote.js > highlightExistingVotes has no case for "+this.VoteTypeId);break}});votesCast=null};var o=function(){return $("div.vote span[id^='vote-accepted-']")};var e=function(){return $("div.post-menu a[id^='lock-post-']")};var w=function(){return $("div.post-menu a[id^='flag-post-']")};var m=function(z){return z.hasClass("vote-up-on")};var a=function(z){return z.hasClass("vote-down-on")};var p=function(z){return z.hasClass("star-on")};var g=function(z){return z.closest("div.vote").find("input").val()};var v=function(A,z){A.removeClass("vote-up-on");z.removeClass("vote-down-on")};var q=function(A,C){var E=A.siblings("span.vote-count-post");var B;if(E.find(".vote-count-separator").length>0){var z=parseInt(E.children(":first").text(),10);var D=Math.abs(parseInt(E.children(":last").text(),10));B=z-D;E.css("cursor","pointer").unbind("click").attr("title",c).click(function(){vote.fetchVoteCounts($(this))})}else{B=parseInt(E.text(),10)}E.text(B+C)};var s=function(B,A){h(B);var z=g(B);n(B,z,A,b)};var n=function(C,A,z,F,E){var D={fkey:fkey};if(E){for(var B in E){D[B]=E[B]}}$.ajax({type:"POST",url:"/posts/"+A+"/vote/"+z,data:D,dataType:"json",success:function(G){F(C,A,G)},error:function(){t(C,"An error has occurred - please retry your request.")}})};var b=function(A,z,B){if(B.Success){if(B.Message){f(A,B.Message)}}else{if(window.console&&window.console.firebug&&(!B.Message||B.Message.length<5)){t(A,"FireBug seems to be enabled, which can sometimes interfere with voting;<br>please refresh the page to see if your vote was processed.<br><br>If this persists, consider disabling FireBug for this site.")}else{t(A,B.Message);v(A,A);A.parent().find("span.vote-count-post").text(B.NewScore);if(B.LastVoteTypeId){i(A,B.LastVoteTypeId)}}}y(A.parent())};var i=function(C,z){var B,A;if(z==j.upMod){B=".vote-up-off";A="vote-up-on"}else{if(z==j.downMod){B=".vote-down-off";A="vote-down-on"}}if(B){C.closest("div.vote").find(B).addClass(A)}};var t=function(z,A){master.showErrorPopup(z.parent(),A)};var f=function(z,A){master.showErrorPopup(z.parent(),A,true)};var k=function(z){if(typeof hasOpenBounty!="undefined"&&hasOpenBounty){return confirm("Are you sure you want to award your bounty to this answer? THIS CANNOT BE UNDONE!")}return true};return{init:function(z){r=!(typeof isRegistered!="undefined"&&isRegistered);if(r){l()}else{if(votesCast==null){d(z)}else{u(votesCast)}y();w().unbind("click").click(function(){vote.flag($(this))})}vote.favorite_init();vote.bountyClose_init();o().unbind("click").click(function(){vote.acceptedAnswer($(this))});var A=$("div.post-menu a[id^='close-question-']");A.unbind("click").click(function(){vote.close(A)});$("div.post-menu a[id^='delete-post-']").unbind("click").click(function(){vote.deletion($(this))})},up:function(C){var D=C.parent().find(".vote-up-off");var B=C.parent().find(".vote-down-off");var A=m(D);var z=a(B);var E=A?-1:(z?2:1);q(C,E);v(D,B);if(!A){D.addClass("vote-up-on")}s(C,A?j.undoMod:j.upMod)},down:function(C){var D=C.parent().find(".vote-up-off");var B=C.parent().find(".vote-down-off");var A=a(B);var z=m(D);var E=A?1:(z?-2:-1);q(C,E);v(D,B);if(!A){B.addClass("vote-down-on")}s(C,A?j.undoMod:j.downMod)},favorite_init:function(){$(".star-off:not(.disabled)").live("click",function(){vote.favorite($(this))})},favorite:function(B){if(x(B)){return}B.addClass("disabled");var C=B.parent().find("div.favoritecount b");var A=parseInt("0"+C.text().replace(/^\s+|\s+$/g,""),10);if(p(B)){B.removeClass("star-on");C.removeClass("favoritecount-selected").text((A--<=0)?"":A)}else{B.addClass("star-on");C.addClass("favoritecount-selected").text(++A)}var z=g(B)||B.siblings("input[type=hidden]").val();n(B,z,j.favorite,function(D){B.removeClass("disabled")})},acceptedAnswer:function(A){var z=A.attr("id").substring("vote-accepted-".length);o().unbind("click");n(A,z,j.acceptedByOwner,function(D,B,E){if(E.Success){$(".vote-accepted-off").removeClass("vote-accepted-on");var C=parseInt(E.Message,10);if(C==j.acceptedByOwner){D.addClass("vote-accepted-on")}else{D.removeClass("vote-accepted-on")}}else{t(D,E.Message)}o().click(function(){vote.acceptedAnswer($(this))})})},bountyClose_init:function(){$(".bounty-vote").hover(function(){$(this).removeClass("bounty-vote-off")},function(){$(this).addClass("bounty-vote-off")});$(".bounty-vote:not(.disabled)").live("click",function(){vote.bountyClose($(this))})},bountyClose:function(A){var z=g(A);if(!k(z)){return}$(".bounty-vote").addClass("disabled");n(A,z,j.bountyClose,vote.bountyClose_callback)},bountyClose_callback:function(E,C,F){var A=$(".bounty-vote");if(F.Success){$("#bounty-notification").remove();hasOpenBounty=false;var B=E.closest("td.votecell").parent().find("span.reputation-score:last");if(F.Message){var G=$(F.Message);B.text(G.text()).attr("title",G.attr("title"))}var D=E.closest("div.vote").find(".bounty-award-container");if(D.length>1){var I=D.filter(":first").find(".bounty-award");var z=parseInt(I.text(),10);var H=parseInt(E.text(),10);I.text("+"+(z+H));A.remove()}else{E.unbind("mouseenter mouseleave").removeClass("bounty-vote bounty-vote-off");A.not(E).remove()}}else{t(E,F.Message);A.removeClass("disabled")}},flag:function(B){var z=B.attr("id").substring("flag-post-".length);var H="form-flag-"+z;var F=$("#"+z+"-only-allow-inform-moderator-flagging").length>0;var I=[[j.offensive,"Offensive, Abusive, or Hate Speech",!F],[j.spam,"Spam",!F],[j.informModerator,"Requires Moderator attention",true]];var E='<div class="popup flag-menu"><h3>Please flag with care:</h3>';E+='<div class="flag-reasons"><form id="'+H+'">';for(var C=0;C<I.length;C++){if(I[C][2]){var J="flag-radio"+z+"-"+I[C][0];E+='<input type="radio" id="'+J+'" name="flag-'+z+'" value="'+I[C][0]+'">';E+='<label for="'+J+'">'+I[C][1]+"</label><br>"}}E+='<div class="flag-comment">Why are you flagging this post?<textarea name="flag-reason" cols="33" rows="4"></textarea>';E+='<br><span class="text-counter"></span></div>';E+="</form></div>";E+='<input type="button" class="flag-cancel" value="Cancel"><input type="button" class="flag-submit" value="Flag Post">';E+="</div>";var D=$(E);var A=D.find("#"+H);var G=A.find("textarea");A.find("input").click(function(){var K=A.find("div.flag-comment");var L=vote.flagIsInform(A);K.toggle(L);if(L){G.focus()}vote.flagAllowSubmit(D,G,L)});G.charCounter({min:10,max:150,setIsValid:function(){vote.flagAllowSubmit(D,G,vote.flagIsInform(A))}});D.find(".flag-submit").click(function(){if(vote.flagIsInform(A)&&!vote.flagTextValid(G)){return}vote.flagSubmit(B,z,A,G)});D.find(".flag-cancel").click(function(){vote.flagClosePopup(B)});B.parent().append(D);D.fadeIn("fast",function(){if(F){A.find("input").click().click()}})},flagIsInform:function(z){var A=z.find("input:radio:checked");if(A.length==0){return false}return A.val()==j.informModerator},flagAllowSubmit:function(A,B,C){var z=C?vote.flagTextValid(B):true;A.find(".flag-submit").toggle(z)},flagTextValid:function(A){var z=A.val().length;return(z>=10&&z<=150)},flagClosePopup:function(z){z.parent().find(".popup").fadeOut("fast",function(){$(this).remove()})},flagSubmit:function(C,A,z,D){vote.flagClosePopup(C);var B=z.find("input:radio:checked").val();var A=C.attr("id").substring("flag-post-".length);if(B==j.informModerator){$.ajax({type:"POST",url:"/messages/inform-moderator-about-post/"+A,dataType:"json",data:{fkey:fkey,msg:D.val()},success:function(E){showAjaxError(C.parent(),E.Message)},error:function(E,G,F){showAjaxError(C.parent(),(E.responseText&&E.responseText.length<100?E.responseText:"An error occurred during submission"))}})}else{n(C,A,B,vote.flagSubmitCallback,{comment:D.val()})}},flagSubmitCallback:function(A,z,C){if(C&&C.Success){if(C.Message){}}else{var B=A.parent();if(C&&C.Message){showAjaxError(B,C.Message)}else{showAjaxError(B,"A problem occurred during flagging")}}},close:function(A){var B=A.text().indexOf("open")>-1;var z=A.attr("id").substring("close-question-".length);if(B){if(confirm("Nominate this question for reopening?")){n(A,z,j.reopen,vote.close_result)}}else{if(!vote.close_reasons){vote.close_fetchReasons(A,z)}else{vote.close_renderForm(A)}}},close_reasons:null,close_votesRemainingToday:0,close_whenCanVote:"",close_hasVoted:false,close_fetchReasons:function(A,z){$(".error-notification").fadeOutAndRemove();appendLoader(A);$.ajax({type:"GET",url:"/posts/close-reasons/"+z,dataType:"json",success:function(B){removeLoader();vote.close_hasVoted=B.hasVoted;vote.close_votesRemainingToday=B.closeVotesRemainingToday;vote.close_whenCanVote=B.whenCanVote;vote.close_reasons=B.reasons;vote.close_renderForm(A)},error:function(B,D,C){removeLoader();showAjaxError(A.parent(),(B.responseText&&B.responseText.length<100?B.responseText:"An error occurred while fetching close reasons"))}})},close_renderForm:function(C){var A=C.attr("id").substring("close-question-".length);var H="form-close-"+A;var I=!vote.close_hasVoted&&vote.close_votesRemainingToday>0;$("#close-popup").remove();var F='<div id="close-popup" class="popup" style="width:710px"><h2 style="margin-bottom:8px;">'+(vote.close_hasVoted?"You have already voted to close this question":vote.close_votesRemainingToday==0?"You have no more close votes today; come back "+vote.close_whenCanVote:"Why should this question be closed?")+'</h2><ul class="close-reasons">';for(var D=0;D<vote.close_reasons.length;D++){var G=vote.close_reasons[D];var B="close-reason-"+G.id;var z=I?'<input type="radio" id="'+B+'" name="close-'+A+'" value="'+G.id+'">':"";F+="<li><table><tr><td>"+z+'</td><td><label for="'+B+'" class="cp"><span class="close-reason">'+G.name+"</span>"+(G.count>0?' <span class="bounty-indicator-tab" style="margin-left:3px; line-height:20px;" title="this many votes already exist">'+G.count+"</span>":"")+'</label></td></tr><tr><td></td><td class="close-desc">'+G.description+"</td></tr></table></li>"}F+='</ul><input type="button" class="close-cancel" value="Cancel">';if(I){F+='<table class="close-submit-container"><tbody><tr><td><span class="bounty-indicator-tab">'+vote.close_votesRemainingToday+"</span> vote"+(vote.close_votesRemainingToday==1?"":"s")+' remaining</td><td><input type="button" class="close-submit" value="Vote to Close" disabled="disabled"></td></tr></tbody></table>'}F+="</div>";var E=$(F);E.find('input[type="radio"]').click(function(){var J=$(this).val();if(J==vote.close_reasonExactDuplicateId){vote.close_duplicateForm(C,E,A)}else{E.find(".close-submit").removeAttr("disabled").css("cursor","pointer")}});E.find(".close-submit").click(function(){vote.close_reasonClick(C,E,A)});E.find(".close-cancel").click(function(){E.fadeOutAndRemove()});E.find("td.close-desc").click(function(){$(this).closest("li").find("input").click()});if(!I){E.find("td, label").css("cursor","auto")}C.parent().append(E);E.fadeIn("fast")},close_reasonExactDuplicateId:1,close_hasLinkedDuplicateQuestions:false,close_isVotingAsDuplicate:false,close_reasonClick:function(A,B,z){var C=B.find('input[type="radio"]:checked').val();if(C==vote.close_reasonExactDuplicateId){vote.close_duplicateForm(A,B,z)}else{B.fadeOutAndRemove();appendLoader(A);n(A,z,j.close,vote.close_result,{"close-reason-id":C})}},close_duplicateForm:function(G,H,C){var D=H.find(".close-submit");D.unbind("click").attr("disabled","disabled").css("cursor","default");H.find("h2, ul").remove();H.css("width","660px");var K="duplicate-question-"+C;var B="hidden"+K;var I='<div style="padding-bottom:18px"><h2>This question is a duplicate of which other question?<div style="float:right"><a href="/search" target="_blank" title="search for duplicate questions (opens in new tab)">search</a></h2><input id="'+B+'" type="hidden"><input id="'+K+'" type="text" size="78" style="width:654px"><span class="edit-field-overlay">Type or paste a question link or numeric question id</span><div class="selected-master-preview"></div><div class="existing-linked-questions"></div></div>';var F=$(I);var z=F.find("#"+K);var A=F.find("#"+B);H.prepend(F);D.click(function(){H.fadeOutAndRemove();vote.close_isVotingAsDuplicate=true;n(G,C,j.close,vote.close_result,{"close-reason-id":vote.close_reasonExactDuplicateId,"duplicate-question-id":A.val()})});var E=vote.close_showExistingDuplicates(H,C);if(E){var J=H.find(".edit-field-overlay");J.text(J.text()+", or click an existing question below")}master.bindHelpOverlayEvents(z);z.typeWatch({highlight:false,wait:750,captureLength:-1,callback:function(){vote.close_duplicateTypeWatch(D,z,C,A)}});z.focus()},close_duplicateTypeWatch:function(C,A,z,B){var D=A.parent().find(".selected-master-preview");C.attr("disabled","disabled").css("cursor","default");D.html("");if($.trim(A.val()).length==0){return}appendLoader(D);$.ajax({type:"GET",url:"/posts/validate-duplicate-question/"+z,data:{val:A.val()},dataType:"json",success:function(E){if(E.success){B.val(E.id);vote.close_showMasterPreview(D,E);C.removeAttr("disabled","disabled").css("cursor","pointer")}else{if(E.title){D.html(E.title)}else{D.html("")}}},error:function(E,G,F){removeLoader();showAjaxError(A.parent(),(E.responseText&&E.responseText.length<100?E.responseText:"An error occurred during duplicate validation"))}})},close_showMasterPreview:function(B,A){var z='<div class="post-text" style="max-height: 400px; overflow: auto;"><h3><a href="'+A.url+'" target="_blank">'+A.title+"</a></h3><p>"+A.body+"</p></div><p>"+A.tags+"</p>";B.html(z)},close_showExistingDuplicates:function(E,z){var D=false;for(var B=0;B<vote.close_reasons.length;B++){var C=vote.close_reasons[B];if(C.id==vote.close_reasonExactDuplicateId){if(C.count>0){D=true}break}}if(!D){return false}var A=E.find("div.existing-linked-questions");appendLoader(A);$.getJSON("/posts/existing-close-duplicate-questions/"+z,function(G){removeLoader();A.append("<p>Other users chose these questions as the best duplicate:</p>");for(var F=0;F<G.length;F++){A.append('<li><input type="radio" name="existing-close" id="existing-close-'+F+'">&nbsp;<label for="existing-close-'+F+'" title="'+G[F].url+'">'+G[F].title+"</label></li>")}A.find("input[type=radio]").click(function(){var H=$(this).siblings("label").attr("title");var I=E.find("input[type=text]");master.hideHelpOverlay(I);I.val(H).keydown()})});return true},close_result:function(A,z,C){removeLoader();if(C&&C.Success){if(C.Message){var D=A.text().indexOf("open")>-1;A.text(A.text().replace(/\w?\(\d\)/,"")+" "+C.Message);t(A,"This question still needs "+C.NewScore+" vote(s) from other users to "+(D?"reopen":"close"));if(vote.close_isVotingAsDuplicate){comments.fetch(z)}}else{location.reload(true)}vote.close_reasons=null}else{var B=A.parent();if(C&&C.Message){showAjaxError(B,C.Message)}else{showAjaxError(B,"A problem occurred during closing/reopening")}}},deletion:function(B){var z=B.attr("id").substring("delete-post-".length);var A=B.text().indexOf("undelete")>-1;if(confirm("Vote to "+(A?"un":"")+"delete this post?")){n(B,z,(A?j.undeletion:j.deletion),vote.deletionCallback)}},deletionCallback:function(C,B,D){var E=C.text().indexOf("undelete")>-1;if(D&&D.Success){C.text(D.Message);if(D.NewScore<0){var A=$("#question:has(a[id='delete-post-"+B+"'])").length>0;var z=A?"#question, div.answer":"#answer-"+B;vote.setDeleteStyles($(z),!E)}else{t(C,"This post still needs "+D.NewScore+" vote(s) from other users to "+(E?"un":"")+"delete")}}else{var F=(D&&D.Message)?D.Message:"A problem occurred during "+(E?"un":"")+"deletion";showAjaxError(C.parent(),F)}},setDeleteStyles:function(A,z){if(z){$("div.question-status:has(span:contains('delete'))").show();A.addClass("deleted-answer").find("a[id^='delete-post-']").addClass("deleted-post").end().find("div[id^='comments-']").addClass("comments-container-deleted").end().find("a[id^='comments-link-']").addClass("comments-link-deleted")}else{document.location.reload(true)}},bountyStart:function(A){var z=$("#question div.vote input:first").val();$.post("/posts/"+z+"/bounty-start",{fkey:fkey,amount:A},function(B){if(B.Success){location.reload(true)}else{t($("#bounty-errors"),B.Message);$("#bounty-submit").attr("disabled","")}},"json")},bindFetchVoteCounts:function(){$(".vote-count-post").attr("title",c).css("cursor","pointer").unbind("click").click(function(){vote.fetchVoteCounts($(this))})},fetchVoteCounts:function(A){var z=A.closest("div.vote").children('input[type="hidden"]').val();appendLoader(A);$.ajax({type:"GET",url:"/posts/"+z+"/vote-counts",dataType:"json",success:function(C){$(".error-notification").fadeOut("fast",function(){$(this).remove()});var B='<div style="color:green">'+C.up+'</div><div class="vote-count-separator"></div><div style="color:maroon">'+C.down+"</div>";A.html(B).unbind("click").css("cursor","default").attr("title",(C.up+" up / "+C.down+" down"))},error:function(B,D,C){removeLoader();showAjaxError(A.parent(),(B.responseText&&B.responseText.length<100?B.responseText:"An error occurred during vote count fetch"))}})}}}();var comments=function(){var o=600;var c=function(p,q){return $("div#comments-"+p+(q||""))};var l=function(p){appendLoader(c(p))};var n=function(){$("a[id^='comments-link-']").unbind("click").click(function(){var p=$(this).attr("id").substr("comments-link-".length);var s=c(p);k(p);s.removeClass("dno");if($(this).text().indexOf("more comment")>-1){comments.fetch(p,s)}else{var r=200+($('form[id^="add-comment-"] > table').length*2);var q=s.find("tfoot form textarea");q.attr("tabindex",r++);s.find("tfoot form input").attr("tabindex",r);if(!q.closest("form").hasClass(".comment-form-expanded")){q.focus()}}$(this).remove()})};var g=function(){$(".comment-up").click(function(){i($(this),2,"comment-up","comment-up-on",function(q,p){q.closest("tr").siblings("tr").remove();q.parent().siblings().children().remove();q.parent().siblings().append(b(p.NewScore))})}).hover(function(){$(this).addClass("comment-up-on")},function(){$(this).removeClass("comment-up-on")});$(".comment-flag").click(function(){if(confirm("Really flag this comment as noise, offensive or spam?")){i($(this),4,"comment-flag","flag-on",function(q,p){if(p.NewScore==-1){q.parents("tr.comment").remove()}else{q.parents("tr.comment").find("img.comment-up").remove();q.remove()}})}}).hover(function(){$(this).addClass("flag-on")},function(){$(this).removeClass("flag-on")});$("div.comments a.comment-edit").click(function(){f($(this))});$(".comment-delete").click(function(){if(confirm("Really delete this comment?")){i($(this),10,"comment-delete","delete-tag-hover",function(q,p){q.parents("tr.comment").remove()})}}).hover(function(){$(this).addClass("delete-tag-hover")},function(){$(this).removeClass("delete-tag-hover")});$("tr.comment").hover(function(){$(this).addClass("comment-hover").find(".comment-up, .comment-flag, .comment-delete, a.comment-edit-hide").css("visibility","visible")},function(){$(this).removeClass("comment-hover").find(".comment-up, .comment-flag, .comment-delete, a.comment-edit-hide").css("visibility","hidden")})};var e=function(){$("tr.comment").unbind("mouseenter mouseleave");$(".comment-up, .comment-flag, .comment-delete, div.comments a.comment-edit").unbind("click mouseenter mouseleave")};var a=function(p,r){var q=c(p," > table > tbody");if(q.children().length>0){q.children().remove()}q.append(r);e();g();removeLoader()};var b=function(r){var p="";if(r&&r>0){var q=r<5?"":r<=15?"warm":r<=30?"hot":"supernova";p+='<span title="number of \'great comment\' votes received" class="'+q+'">'+r+"</span>"}return p};var d=function(p,s,q,v){var r='<table><tr><td><textarea name="comment" cols="68" rows="3"></textarea></td><td><input type="submit" value="'+s+'"/>'+(q?'<a class="edit-comment-cancel">cancel</a>':"")+'</td></tr><tr><td colspan="2"><span class="text-counter"></span><span class="form-error"></span></td></tr></table>';p.append(r);if(q){p.find(".edit-comment-cancel").click(function(){h($(this))})}var t=false;var u=function(w){t=w};p.find("textarea").charCounter({min:15,max:600,setIsValid:u});p.submit(function(){if(t){disableSubmitButton(p);v(p)}else{p.find("span.text-counter").animate({opacity:0},100,function(){$(this).animate({opacity:1},100)})}return false})};var k=function(p){d($("#add-comment-"+p),"Add Comment",false,j)};var j=function(q){var p=q.attr("id").substr("add-comment-".length);l(p);var r=function(){$(".error-notification").fadeOut("fast",function(){$(this).remove()})};var s=q.find("textarea");var t=s.val();if(!t||$.trim(t)==""){return}$.ajax({type:"POST",url:"/posts/"+p+"/comments",dataType:"html",data:{comment:t,fkey:fkey},success:function(u){r();a(p,u);s.val("").keyup();enableSubmitButton(q)},error:function(u,w,v){removeLoader();r();showAjaxError(q,(u.responseText&&u.responseText.length<100?u.responseText:"An error occurred during comment submission"));enableSubmitButton(q)}})};var f=function(s){var r=s.closest("tr.comment");var p=r.find('form[id^="edit-comment-"]');r.find("td.comment-actions *").hide();r.find("td.comment-text > div").hide();r.find("td:last").addClass("comment-form");d(p,"Save Edits",true,m);var q=p.find("textarea");q.val(p.find("div").text());p.show();q.focus()};var m=function(q){appendLoader(q.parent());var s=q.attr("id").substr("edit-comment-".length);var p=q.closest("div.comments").attr("id").substr("comments-".length);var r=function(){$(".error-notification").fadeOut("fast",function(){$(this).remove()})};var t=q.find("textarea");var u=t.val();if(!u||$.trim(u)==""){return}$.ajax({type:"POST",url:"/posts/comments/"+s+"/edit",dataType:"html",data:{comment:u,fkey:fkey},success:function(v){r();a(p,v)},error:function(v,x,w){removeLoader();r();showAjaxError(q,(v.responseText&&v.responseText.length<100?v.responseText:"An error occurred during comment submission"));enableSubmitButton(q)}})};var h=function(r){var q=r.closest("tr.comment");var p=q.find('form[id^="edit-comment-"]');p.children("table").remove();p.hide();q.find("td:last").removeClass("comment-form");q.find("td.comment-actions *").show();q.find("td.comment-text > div").show()};var i=function(v,r,t,w,q){var s=v.parents("tr.comment").attr("id").substr("comment-".length);$("div.error-notification").hide();v.removeClass(t).unbind("click mouseenter mouseleave").addClass(w);appendLoader(v.parent());var p=function(){v.removeClass(w).addClass(t).click(function(){i(v,r,t,w,q)})};var u="#comment-"+s+" td.comment-actions";$.ajax({type:"POST",url:"/posts/comments/"+s+"/vote/"+r,dataType:"json",data:{fkey:fkey},success:function(x){if(x.Success){q(v,x)}else{master.showErrorPopup(u,x.Message);p()}},error:function(x,z,y){master.showErrorPopup(u,(x.responseText&&x.responseText.length<100?x.responseText:"An error occurred during voting"));p()}});removeLoader()};return{init:function(){n();g();$("form.comment-form-expanded").closest("div.comments").siblings("a.comments-link").click()},fetch:function(p,q){if(!q){q=c(p)}l(p);$.ajax({type:"GET",url:"/posts/"+p+"/comments",dataType:"html",success:function(r){a(p,r)},error:function(r,t,s){removeLoader();showAjaxError(c(p),(r.responseText&&r.responseText.length<100?r.responseText:"An error has occured while fetching comments"))}})}}}();function editorReady(c,b,a){$.get("/questions/ticks",function(d){$("#edit-block").append("<input type='hidden' name='i1l' value='"+d+"' />")});if($("#show-editor-button").length==0&&$("#wmd-preview").length!=0){initPostEditor(c,b,a)}}function initPostEditor(f,d,a){var c=$("#post-form");var b=$("#wmd-input");var e=$("#title, #tagnames, #edit-comment, #m-address");c.submit(function(){var g=true;var h=function(i){g=i};e.each(function(){master.hideHelpOverlay($(this))});if(g){disableSubmitButton(c);setConfirmUnload(null)}return g});$("#original-question").not(".processed").TextAreaResizer();b.not(".processed").TextAreaResizer();b.typeWatch({highlight:false,wait:5000,captureLength:5,callback:styleCode});Attacklab.wmdBase();Attacklab.Util.startEditor();if(f){heartbeat.heartbeatNamespace=d;b.keypress(heartbeat.start)}if(!a){b.keypress(initNavPrevention)}$("#wmd-preview").click(function(){b.focus()});master.bindHelpOverlayEvents(e);if($("#ask-error-container").length==0){$("#title").focus()}}var invalidElements=function(){var b=[];var a=function(c){return c.attr("name")};return{add:function(e){var c=a(e);var f=true;for(var d=0;d<b.length;d++){if(b[d]==c){f=false;break}}if(f){b.push(c)}},remove:function(e){var c=a(e);for(var d=0;d<b.length;d++){if(b[d]==c){b.splice(d,1)}}},any:function(){return b.length>0}}}();function initNavPrevention(a){if(a.which=="undefined"){return}var b=$("#wmd-input");b.unbind("keypress",initNavPrevention);setConfirmUnload("You have started writing or editing a post.",b)}var heartbeat=function(){var d=1000*45;var b;var e=0;var a=false;var c=0;return{heartbeatNamespace:null,start:function(f){if(f.which=="undefined"){return}if(e++>0){return}$("#wmd-input").unbind("keypress",heartbeat.start);heartbeat.heartbeatNamespace.init();setTimeout(heartbeat.heartbeatNamespace.ping,d)},answers:function(){return{name:"heartbeat.answers",init:function(){b=location.href.match(/\/questions\/(\d+)/i)[1]},ping:function(){var f="";$("div.answer").each(function(){f+=this.id.substring("answer-".length)+" "});$.post("/posts/"+b+"/answer-activity-heartbeat",{answerIds:f},heartbeat.answers.result,"json")},result:function(g){var f=++c<30;if(g&&!a){if(g.NoPosting){var h="This question has been "+g.Msg+" - no more answers will be accepted.";notify.show(h);a=true;disableSubmitButton("#post-form");setConfirmUnload(null);f=false}else{if(g.Result){var h=g.Count+" new answer"+(g.Count==1?" has":"s have")+" been posted - ";h+='<a onclick="heartbeat.answers.update()">load new answers.</a>';notify.show(h);a=true}}}if(f){setTimeout(heartbeat.answers.ping,d)}},update:function(){var f=[];$.get("/questions/"+b,function(i){var l=$(i);l.find("div.answer").each(function(){var m=this.id.substring("answer-".length);if($("#answer-"+m).length==0){f.push(this.id)}});if(f.length>0){var h="#"+f.join(",#");var k=l.find(h);var g=$("div.answer:last");if(g.length==0){g=$("#answers-header")}k.hide();g.after(k);k.fadeIn("slow");var j=$("div.answer").length;$(".subheader h2").text(j+" Answer"+(j>1?"s":""));vote.init(b);comments.init()}notify.close();a=false},"html")}}}(),edits:function(){return{name:"heartbeat.edits",init:function(){b=$("#post-id").val()},ping:function(){$.post("/posts/"+b+"/edit-activity-heartbeat",{currentRevisionGuid:$("#current-revision-guid").val()},heartbeat.edits.result,"json")},result:function(g){var f=++c<30;if(g&&!a){if(g.message){if($("#notify-table td.notify").text()!=g.message){notify.close();notify.show(g.message)}setConfirmUnload(null);if(!g.success){disableSubmitButton("#post-form");f=false}}}if(f){setTimeout(heartbeat.edits.ping,d)}},update:function(){}}}()}}();(function(a){a.fn.typeWatch=function(d){var b=a.extend({wait:750,callback:function(){},highlight:true,captureLength:2},d);function c(h,g){var f=a(h.el).val();if((f.length>b.captureLength&&f.toUpperCase()!=h.text)||(g&&f.length>b.captureLength)){h.text=f.toUpperCase();h.cb(f)}}function e(g){if(g.type.toUpperCase()=="TEXT"||g.nodeName.toUpperCase()=="TEXTAREA"){var h={timer:null,text:a(g).val().toUpperCase(),cb:b.callback,el:g,wait:b.wait};if(b.highlight){a(g).focus(function(){this.select()})}var f=function(i){var l=h.wait;var k=false;if(i.keyCode==13&&this.type.toUpperCase()=="TEXT"){l=1;k=true}var j=function(){c(h,k)};clearTimeout(h.timer);h.timer=setTimeout(j,l)};a(g).keydown(f)}}return this.each(function(f){e(this)})}})(jQuery);(function(c){var h,i;var d=0;var a=32;var e;c.fn.TextAreaResizer=function(){return this.each(function(){h=c(this).addClass("processed"),i=null;c(this).parent().append(c('<div class="grippie"></div>').bind("mousedown",{el:this},b));var k=c("div.grippie",c(this).parent())[0];k.style.marginRight=(k.offsetWidth-c(this)[0].offsetWidth)+"px"})};function b(k){h=c(k.data.el);h.blur();d=j(k).y;i=h.height()-d;h.css("opacity",0.25);c(document).mousemove(g).mouseup(f);return false}function g(m){var k=j(m).y;var l=i+k;if(d>=(k)){l-=5}d=k;l=Math.max(a,l);h.height(l+"px");if(l<a){f(m)}return false}function f(k){c(document).unbind("mousemove",g).unbind("mouseup",f);h.css("opacity",1);h.focus();h=null;i=null;d=0}function j(k){return{x:k.clientX+document.documentElement.scrollLeft,y:k.clientY+document.documentElement.scrollTop}}})(jQuery);